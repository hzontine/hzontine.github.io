---
layout: post
title: Flask-SocketIO
---

In CPSC 350, I was also challenged to learn how to communicate real time between clients and my server. This is easily implemented with Flask through Socket.IO.

## What is SocketIO?

Socket.IO is a JavaScript library for realtime web applications.It is composed of two parts:
 
  * a client-side library that runs in the browser 
  * server-side library for node.js. 
  
Both components have essentially an identical API. This AngularJS wrapper for Controllers can send data from the front-end to the back-end, and the back to the front. Similar to node.js, Socket.IO is _event-driven_.

## Importing Flask extension

The extension socketio must be imported from Flask.

{% highlight python %}

from flask.ext.socketio import SocketIO, emit, join_room, leave_room, send

{% endhighlight %}

## Front-End
 You need to create a Javascript function that, whenever something is clicked on the website, will be called. Depending on what was clicked, data can be transmitted from the front-end to the back-end, through the function that implements SocketIO in Flask.

{% highlight python %}

$scope.setName = function setName(){
    socket.emit('identify', $scope.name)  
};

{% endhighlight %}

## Back-End
 On the Python side, data is sent to the function that was named in the first parameter of socket.emit(). In this case, the function is named: **identify**. The second parameter, which holds the data, is to be sent to Flask.

{% highlight python %}

@socketio.on('identify', namespace='/movies')
def on_identify(user):
    print('Identify: ' + user)
    users[session['uuid']] = {'username' : user}
    
Let's say the user's name is hzontine.
When this function is run by Flask, it prints 'Identify: hzontine.' Afterwards, it assigns hzontine as a username to the the list of current users in the session.

## Display Data

### From the Back-End: by using this function to emit from Flask

@socketio.on('connect', namespace='/movies')
def onConnect():
    print('Session on connect...')
    print(session)
    #session['uuid'] = uuid.uuid1()
    emit('on_connect', {'logged_in' : 'username' in session})

### To the Front-End: by using this function to send data back to the Javascript

socket.on('on_connect', function(data){
       console.log('Connected'); 
       $scope.logged_in = data['logged_in'];
       console.log('logged in: ');
       console.log(data['logged_in']);
       $scope.$apply();
});

We have to check if our Socket recieves data from the server. If so, and our Socket is send to the correct function, then the  function is called.


